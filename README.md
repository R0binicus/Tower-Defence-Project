# Tower Defence Project

An automated turret and tower defence project that I created in the Unreal Engine, made with C++, as part of my course at CG Spectrum.

This project was split into two briefs, one about making an automated turret, the other about making a tower defence game
For the first brief, I had to make a turret that tracked and shot at enemies for a tower defence game. After setting up some basic enemies, the next step was to find the closest enemy’s location, which was easy. However, I then had to figure out how to get the correct direction the turret needs to face, then rotate towards that angle. To do this, I got the dot product of the turret’s facing direction and the direction to the enemy. I then calculated the dot product’s arccosine to get the degrees to the enemy. The only issue is that this doesn’t say which way the turret needs to rotate. I solved this by using the cross product of the turret facing direction and the direction to the enemy, then getting the sign, which gave me the anti/clockwise direction (signed angle). I could then use a linear interpolation to make the turret rotate over time to face the enemy, and fire a projectile when the turret was facing the enemy, again using the dot product.

By this point, I had already done all I needed for the brief, so I had time for extension work! So, I considered what else turret related I could implement that might be useful for a tower defence game. What I settled upon was adding different turret aiming modes and projectile types. 
The projectile types were fairly simple, the original, base projectile just used Unreal physics with an initial launch velocity. I then added a homing projectile that used a lerp to go towards the enemy and finally a ‘smart homing’, which gradually increases its homing as it gets closer to its target. 

The next step was the turret aiming modes, which is where the main difficulty began. The base aiming mode just faces the enemy, shoots and often misses as it ignores gravity. I wanted to make the turret consider gravity when changing its pitch to aim at the enemy target, shooting the projectile in an arc. I knew this was a projectile motion problem, which I learnt all about in high school, however it's been a while and I was a bit rusty. Luckily, I found a blog post of someone solving this exact problem, but when I implemented it, the equation didn’t work. After spending close to a day on this problem, I remembered that in high school, we always needed to make sure our calculators were in degrees, not radians. After a quick check, I confirmed that, yup, trigonometric functions in C++ expect the input to be in radians, not degrees. After that, it worked great!
Blog post mentioned can be found here: https://www.forrestthewoods.com/blog/solving_ballistic_trajectories/ 

It was after this point that I received a new brief, to make the various features of a tower defence game, including the UI, enemy wave spawning, win/lose conditions and building system.
I decided to first work on the building system. For this, I made a simple block, which would detect when the player clicked on it, using Unreal's inbuild actor OnClicked function to spawn a turret. This was quick and worked great, however the block would only spawn a single turret type and, I needed to have the player pick from several, while having this easy to add new turrets. To do this, I used data assets, and made a BuildingDataAsset, which would store all the information the building system would need, such as cost, a building icon, name, turret class and more. I could then make UI buttons, which display the info when assigned then send the data asset to a building subsystem. I then had the building blocks access this info when they needed to make a new turret, and reduce the player resources accordingly. 

Partway through the building system, I also started working on the wave spawning system. I specifically made this with designers in mind, trying to make it as easy as possible to change, even if I was the only person working on this. At first, I had wave object placed in the level, which had an array of wave data structs. This contained all the necessary information about what enemies would spawn, how many, and which spawners they would come from. This worked great at first, but I wasn't happy that it was stored on an object in the map, and wanted to use data assets. However, the issue was that I would still need to assign in the map the associated data asset. My way around this was to use primary data assets, the asset manager and and weak pointers. I made primary data assets to store each level's wave data, using a dictionary in the game instance, to link the LevelDataAsset to the level name, which would then be loaded at the start of the level. Additionally, I made the reference to the wave spawner locations a weak pointer to allow the reference to persist even when the map wasn't open.

Throughout both of these, I was also working on the UI. Although not as flashy or complicated as the other game aspects, it is definitely important. I made a special effort to do it in best practice, making it all event-based, by binding the updates to the UI widgets to events, which would be decoupled from the UI. These events would be triggered by things such as a wave change, which would send an event to update the enemies remaining and current wave counters. 

After this, I had some extra time. I decided to spend this time putting all the features together into a completed and playable game, which brings the project to what it is now. This also has not been an exhaustive list of what the turrets or the rest of the game includes, just some highlights. If I had the opportunity to do this project again, I would probably try to add more turret types, such as a laser beam turret, a slowing status effect turret and change the existing projectile. I also might make a generic object pooling component with interfaces, to allow me to more easily reuse object pooling for more circumstances, and try to use the gameplay ability system.

My main focus for this whole project was getting better at and practising general game programming skills and Unreal C++. I’ve definitely got a lot out of these past few months, had a great time and learnt a lot.

## Key Features

- **Turret Tracking System**: Automated turret tracks and turns to face the nearest enemy.
- **Turret Aiming Modes**: Turret can be set to aim directly towards the enemy, at an angle so that the projectile moves in an arc, or with future position prediction.
- **Projectile Behaviour Types**: Projectiles can be launched with initial velocity, homing, or a combination of the two.
- **Enemy Wave Spawning System**: Enemy wave spawning system which uses data assets for easy modification by designers.
- **Event-Based UI**: UI which uses events to communicate for improved performance and reduced coupling. 
- **Turret Building System**: Building system to allow turrets to be selected, sold and placed in specific locations.